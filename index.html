State<-get_acs(geography = "state",
                      variables = Variables,
                      survey = "acs5",  
                      year = 2020,
                      output = "wide",
                      geometry=T)

States<-State[,c("GEOID", "NAME", "MHIE", "MHVE", "TotalpopE", "geometry")]

names(States)[names(States) =="MHIE"]<-"MHI"
names(States)[names(States) =="MHVE"]<-"MHV"
names(States)[names(States) =="TotalpopE"]<-"Totalpop"

palMHI<-colorQuantile(palette = "viridis", domain=States$MHI, n=10)
palMHV<-colorQuantile(palette = "RdYlBu", domain=States$MHV, n=10)
palpop<-colorQuantile(palette = "RdBu", domain=States$Totalpop, n=10)

map<-States %>%
  st_transform(crs = "+init=epsg:4326") %>%
  leaflet() %>%
  setView(lng = -98.55, lat = 39.8098, zoom = 3)%>%
  addTiles(group = "OSM (default)") %>%
  addProviderTiles(providers$CartoDB.Positron, group = "Carto B") %>%
  addPolygons(group = "Total",
    popup = paste("State: ", States$NAME, "<br>",
                            "Total Population: ", States$Totalpop, "<br>",   
                            "Median Household Income: ", "$", States$MHI, "<br>",
                            "Median Home Value: ", "$", States$MHV, "<br>"),
              stroke = FALSE,
              smoothFactor = 0,
              fillOpacity = 0.7,
              color = ~ palpop(Totalpop)) %>%
  addLegend(position = "bottomleft", pal=palpop, values= States$Totalpop,
            title="Percentile of State Total Population", group = "Total", opacity = 1) %>% 
  addPolygons(group = "MHI",
              popup = paste("State: ", States$NAME, "<br>",
                            "Total Population: ", States$Totalpop, "<br>",
                            "Median Household Income: ", "$", States$MHI, "<br>",
                            "Median Home Value: ", "$", States$MHV, "<br>"),
              stroke = FALSE,
              smoothFactor = 0,
              fillOpacity = 0.7,
              color = ~ palMHI(MHI)) %>%
  addLegend(position = "bottomright", pal=palMHI, values= States$MHI, 
            title="Percentile of State Median Household Income", group = "MHI", opacity = 1) %>% 
  addPolygons(group = "MHV",
              popup = paste("State: ", States$NAME, "<br>",
                            "Total Population: ", States$Totalpop, "<br>",
                            "Median Household Income: ", "$", States$MHI, "<br>",
                            "Median Home Value: ", "$", States$MHV, "<br>"),
              stroke = FALSE,
              smoothFactor = 0,
              fillOpacity = 0.7,
              color = ~ palMHV(MHV)) %>%
  addLegend(position = "bottomleft", pal=palMHV, values= States$MHV, 
            title="Percentile of State Median Household Income", group = "MHV", opacity = 1) %>% 

  hideGroup("MHI") %>% 
  hideGroup("MHV") %>% 
  addLayersControl(
    baseGroups = c("OSM (default)", "Toner Lite", "Carto B"),
    overlayGroups = c("Total", "MHI", "MHV"),
    options = layersControlOptions(collapsed = FALSE)) 
  
map
